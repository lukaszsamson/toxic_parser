## ToxicParser review

1. **Checkpoint drop rewinds stream unexpectedly** (`lib/toxic_parser/token_adapter.ex`, `drop_checkpoint/2`): the function calls `Toxic.rewind_to/2` even though the docstring promises to “drop … without rewinding”, which silently rewinds the tokenizer when callers merely intend to free a checkpoint. This can reorder parsing state and diagnostics; `drop_checkpoint/2` should skip the rewind.
2. **Lookahead caching is quadratic** (`lib/toxic_parser/token_adapter.ex`, `maybe_cache/3`): caching appends with `lookahead ++ [token]`, copying the whole buffer on every peek/next that caches. Switching to cons + reverse (or using an :queue) would avoid O(n²) growth in heavy lookahead paths like `peek_n/2`.
3. **Scope accumulator stores nested lists** (`lib/toxic_parser/env.ex`, `exit_scope`/`from_events`): exiting a scope wraps the child list inside the parent (`[top | parent]`) instead of concatenating (`parent ++ top`), producing nested lists that flatten later but degrade readability and make subsequent bindings prepend onto a list-of-lists. Keeping scopes as flat stacks per frame would simplify the structure and reduce needless flattening.
4. **Duplicate build_result branches** (`lib/toxic_parser.ex`, `build_result/1`): there are two nearly identical clauses differing only by `extra_diagnostics` defaulting to `[]`. Consolidating them via a single function with a default would reduce divergence risk and ease maintenance.
5. **Event log mismatches raise** (`lib/toxic_parser/event_log.ex`, `end_node/3`): a mismatched `end_node` raises an `ArgumentError`, which crashes tolerant parsing instead of surfacing as a diagnostic event. Consider returning an error event or structured error to keep the parser from exploding on malformed inputs.
6. **Pratt no-parens arg parsing re-reverses accumulators** (`lib/toxic_parser/pratt.ex`, `parse_no_parens_args*_with_min_bp`): repeated `Enum.reverse(acc) ++ ...` in tight recursion makes argument parsing O(n²) and hard to follow. Refactoring to accumulate in order (or use difference lists) would improve performance and clarity.
